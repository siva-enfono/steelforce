<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>POS Sales Summary</title>

<style>
@page { size: 80mm auto; margin: 3mm; }

body {
  font-family: Arial, sans-serif;
  font-size: 12px;   /* âœ… ALL TEXT = 12px */
  font-weight: 600;
  width: 80mm;
  margin: 0;
}

/* LOGO */
.logo { text-align: center; margin-bottom: 4px; }
.logo img { max-width: 45mm; max-height: 18mm; }

/* HEADER */
.title { text-align: center; font-size: 12px; font-weight: 800; }
.pos-profile, .period {
  text-align: center;
  font-size: 12px;
  font-weight: 700;
  margin-bottom: 4px;
}

/* TOP SUMMARY */
.top-summary {
  border-top: 2px solid #000;
  border-bottom: 2px solid #000;
  padding: 6px 0;
  margin: 6px 0;
}

.top-summary-row {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  font-weight: 800;
  padding: 2px 0;
}

/* TABLE */
table { width: 100%; border-collapse: collapse; margin-top: 4px; }

th, td { padding: 4px 2px; font-size: 12px; }

/* HEADER */
th {
  border-bottom: 2px solid #000;
  font-weight: 900;
  color: #000;
  text-align: left;
}

.text-right { text-align: right; }

/* ROW TYPES */
.parent { font-weight: 700; border-top: 1px dashed #000; }
.child td:first-child { padding-left: 10px; }
.summary { font-weight: 800; border-top: 1px solid #000; }

</style>
</head>

<body>

<!-- LOGO -->
<div class="logo">
  <img src="https://altabiah.b.frappe.cloud/files/logo_Final_page-0001.jpg">
</div>

<div class="title">POS SALES SUMMARY</div>

{% if (filters.pos_profile) { %}
<div class="pos-profile">Branch : {%= filters.pos_profile %}</div>
{% } %}

<div class="period">
{% if (filters.from_date && filters.to_date) { %}
  {%= frappe.datetime.str_to_user(filters.from_date) %}
  TO
  {%= frappe.datetime.str_to_user(filters.to_date) %}
{% } %}
</div>

<!-- =========================
     EXTRACT VALUES FROM DATA
     ========================= -->
{%
  var total_sales = 0;
  var total_cash = 0;
  var total_card = 0;

  for (var i = 0; i < data.length; i++) {
    var r = data[i];
    if (!r.name) continue;

    if (r.name.toUpperCase().indexOf("TOTAL") !== -1) {
      total_sales = r.amount || 0;
    }

    if (r.name.indexOf("Total Cash") !== -1) {
      total_cash = r.amount || 0;
    }

    if (r.name.indexOf("Total Card") !== -1) {
      total_card = r.amount || 0;
    }
  }
%}

<!-- =========================
     TOP SUMMARY DISPLAY
     ========================= -->
<div class="top-summary">
  <div class="top-summary-row">
    <span>Total Sales (With VAT)</span>
    <span>{%= total_sales.toFixed(2) %}</span>
  </div>
  <div class="top-summary-row">
    <span>Total Cash</span>
    <span>{%= total_cash.toFixed(2) %}</span>
  </div>
  <div class="top-summary-row">
    <span>Total Card</span>
    <span>{%= total_card.toFixed(2) %}</span>
  </div>
</div>

<!-- =========================
     FULL DETAILS TABLE
     ========================= -->
<table>
<thead>
  <tr>
    <th style="
        font-weight:900;
        font-size:12px;
        color:#000;
        border-top:2px solid #000;
        border-bottom:2px solid #000;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    ">
      <strong>Sales Mode</strong>
    </th>

    <th class="text-right" style="
        font-weight:900;
        font-size:12px;
        color:#000;
        border-top:2px solid #000;
        border-bottom:2px solid #000;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    ">
      <strong>Amt</strong>
    </th>
  </tr>
</thead>

<tbody>

{% for (var i = 0; i < data.length; i++) { 
    var row = data[i];
%}

  {% if (row.indent === 0 && !row.invoice) { %}
    <tr class="parent">
      <td>{%= row.name %}</td>
      <td class="text-right">{%= (row.amount || 0).toFixed(2) %}</td>
    </tr>

  {% } else if (row.indent === 1) { %}
    <tr class="child">
      <td>{%= row.name %}</td>
      <td class="text-right">{%= (row.amount || 0).toFixed(2) %}</td>
    </tr>

  {% } else { %}
    <tr class="{% if (row.name && row.name.indexOf('VAT') !== -1) { %}summary{% } %}">
      <td>{%= row.name %}</td>
      <td class="text-right">{%= (row.amount || 0).toFixed(2) %}</td>
    </tr>
  {% } %}

{% } %}

</tbody>
</table>

</body>
</html>
